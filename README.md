# 基于强化学习与混合规划的机器人自主导航系统

## 项目概述

本项目是一个可视化的机器人路径规划仿真平台，旨在解决二维网格环境下的自主导航与避障问题。系统采用了 **强化学习 (Q-Learning)** 与 **启发式搜索 (BFS)** 相结合的混合路径规划策略，不仅能让智能体在大规模训练中习得全局最优策略，还能通过局部搜索机制有效应对未知的突发障碍物，显著提升了泛化能力和鲁棒性。

项目集成了基于 Flask 的 Web 交互界面，支持实时训练监控、环境自定义以及极其丰富的可视化分析（动态 GIF、静态路线图、热力图等）。

---

## 核心功能

### 1. 混合智能导航
*   **Q-Learning 全局规划**：利用查表法（Q-Table）学习静态环境下的全局最优路径。
*   **BFS 局部避障**：在遇到训练中未见过的复杂障碍物陷阱时，自动触发广度优先搜索（BFS）进行局部绕行，解决单纯 RL 算法容易陷入死锁的问题。

### 2. 交互式仿真环境
*   **Web 控制台**：直观的网格编辑器，支持鼠标点击设置障碍物、起点和终点。
*   **随机生成**：支持一键生成随机地形，用于测试模型的泛化能力。

### 3. 多维度可视化
系统在每次运行后会自动生成以下可视化分析图表（Web端实时展示）：
*   **最优路径动画 (GIF)**：动态展示机器人的移动和决策过程。
*   **完整路线图 (Static PNG)**：[新增] 一目了然的静态全局路径覆盖图。
*   **策略方向图**：展示智能体在每个位置的决策倾向。
*   **价值函数热力图**：可视化状态价值分布，越亮区域代表离目标越近或价值越高。
*   **训练曲线**：记录奖励变化与步数收敛情况。
*   **效率分析**：对比实际路径与其曼哈顿距离/BFS最短路径的效率差异。

---

## 技术架构与原理

### 项目结构
```
Auto-Robot-Road-Planning/
├── agent/
│   └── q_learning.py      # 混合智能体实现 (Q-Learning + BFS Bypass)
├── env/
│   └── grid_world.py      # 网格环境逻辑 (状态/动作/奖励定义)
├── utils/
│   └── visualization.py   # 绘图引擎 (Matplotlib)
├── app.py                 # Flask 后端服务
├── static/                # 前端资源 (JS/CSS/图表)
├── templates/             # HTML 模板
└── train.py               # 离线训练脚本
```

### 算法核心

#### 1. 强化学习 (Q-Learning)
智能体通过与环境交互更新 Q 值表，公式如下：
$$Q(s, a) \leftarrow Q(s, a) + \alpha [r + \gamma \max_{a'} Q(s', a') - Q(s, a)]$$
*   **状态空间**：10x10 网格坐标。
*   **动作空间**：上、下、左、右。
*   **奖励函数**：
    *   到达终点：+100
    *   撞墙/障碍：-5 / -10
    *   每步移动：-1 (鼓励最短路径)

#### 2. 混合规划策略 (Hybrid Planning)
为了解决 Q-Learning 在生疏环境中的“死循环”问题，我们在决策逻辑中引入了双层机制：
*   **层级 1 (RL)**：优先使用 Q-Table 选择动作。
*   **层级 2 (BFS)**：如果 RL 决策导致位置不变（撞墙）或进入历史路径循环，则激活 BFS 搜索器，规划一条通往未访问区域的局部最短路径，帮助智能体脱困。

---

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动 Web 界面 (推荐)
```bash
python app.py
```
启动后访问浏览器：`http://localhost:5000`
*   在网页中点击 **"重新训练"** 即可开始学习。
*   点击 **"随机生成环境"** -> **"验证模型"** 可测试智能体在陌生环境下的表现。

### 3. 命令行模式
```bash
# 训练模型
python train.py --episodes 1000

# 测试随机环境
python train.py --random-obstacles
```

---

## 评估指标

系统会自动计算以下指标用于评估模型质量：
*   **成功率**：完成任务的 Episode 比例。
*   **路径效率**：实际步数与理论最短路径（BFS/曼哈顿）的比值。
    *   *注：由于混合策略的存在，智能体即使在未见过很多障碍物的情况下，也能保持极高的成功率。*

---

## 许可证
本项目仅供学术交流与学习使用。
